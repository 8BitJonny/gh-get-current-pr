# `dist/index.js` is a special file in Actions.
# When you reference an action with `uses:` in a workflow,
# `index.js` is the code that will run.
# For our project, we generate this file through a build process from other source files.
# We need to make sure the checked-in `index.js` actually matches what we expect it to be.
name: Check dist/

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
  pull_request:
    paths-ignore:
      - '**.md'
  workflow_dispatch:

jobs:
  check-dist:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - id: dist
        env:
          BUILD_HASH: ${{ hashFiles('dist') }}
        run: echo "::set-output name=hash::$BUILD_HASH"
      - run: npm install
      - run: npm run all
      - name: Test Action package is up to date
        uses: pr-mpt/actions-assert@v3
        with:
          assertion: npm://@assertions/is-equal:v1
          expected: "${{ steps.dist.outputs.hash }}"
          actual: "${{ hashFiles('dist') }}"
          error-message: "Action package (`dist`) is not up to date with latest changes, please run `npm run all`"
